@mixin squareIconButton($modifier: '') {
   &.env-button--icon#{$modifier}:not(.env-button--icon-after):not(.env-button--icon-before):not(.env-button--icon-around):not(.env-button--icon-above) {
      @content;
   }
}

@mixin button-color-variant($name: '') {
   @if ($name != '') {
      $name: '-#{$name}';
   }
   $color: 'element#{$name}-font-color';
   $background-color: 'element#{$name}-background-color';
   $background-color-dark: 'element#{$name}-background-color-dark';
   $background-color-light: 'element#{$name}-background-color-light';
   background-color: css-var($background-color);
   border-color: css-var($background-color);
   color: css-var($color);

   // Dark border for dropdown split button
   .env-dropdown.env-button-group &:not(:first-child):not(.env-button--ghost) {
      border-left-color: css-var($background-color-dark);
   }

   &.env-button--ghost {
      background-color: transparent;
      border-color: css-var($background-color);
      color: css-var($background-color);
   }

   &:hover,
   &:focus {
      background-color: css-var($background-color-dark);
      border-color: css-var($background-color-dark);
      color: css-var($color);
   }

   &:active {
      background-color: css-var($background-color-light);
      border-color: css-var($background-color-dark);
      color: css-var($color);
   }
}

@mixin button-size($size) {
   $button-border-radius: strip-unit($button-border-radius);

   // Button font sizes (px)
   $btn-small-font-size: 14; // --env-font-size-small
   $btn-medium-font-size: 16; // --env-font-size-medium
   $btn-large-font-size: 20; // --env-font-size-large
   $btn-iconabove-font-size: 12; // (saknas som variabel)

   // Button border-radius setting in Sitevision (em)
   $btn-default-border-radius: 0.375; // --env-button-border-radius

   // Border radiuses for buttons (px)
   $btn-small-border-radius: 3;
   $btn-medium-border-radius: 6;
   $btn-large-border-radius: 10;

   // Horizontal paddings for buttons (px)
   $btn-small-padding: 8;
   $btn-medium-padding: 21;
   $btn-large-padding: 23;
   $btn-slim-padding: 8;
   $btn-iconabove-padding: 10;
   $btn-iconabove-link-padding: 8;

   // Default button heights (px)
   $btn-small-min-height: $form-input-height / 2; // 22
   $btn-medium-min-height: $form-input-height; // 44
   $btn-large-min-height: $form-input-height * 1.27273; // 56
   $btn-slim-min-height: 32; // Old default button height

   // Radius - scaled relative to variable in settings (0.375em default),
   /* prettier-ignore */
   $radiusScales: (
      // small =>  3px (default)
      small: (($btn-small-border-radius / $BROWSER_FONT_SIZE / $button-border-radius) / ($btn-small-font-size / $BROWSER_FONT_SIZE)),
      // medium =>  6px (default)
      medium: ($btn-medium-border-radius / $BROWSER_FONT_SIZE / $button-border-radius),
      // large => 10px (default)
      large: (($btn-large-border-radius / $BROWSER_FONT_SIZE / $button-border-radius) / ($btn-large-font-size / $BROWSER_FONT_SIZE)),
      // slim => 6px  (Same as medium),
      slim: ($btn-medium-border-radius / $BROWSER_FONT_SIZE / $button-border-radius)
   );
   $minHeights: (
      small: (
         $btn-small-min-height / $btn-small-font-size * 1em,
      ),
      medium: (
         $btn-medium-min-height / $btn-medium-font-size * 1em,
      ),
      large: (
         $btn-large-min-height / $btn-large-font-size * 1em,
      ),
      slim: (
         $btn-slim-min-height / $btn-medium-font-size * 1em,
      ),
   );
   $fontSizes: (
      // small => 14 px
      small: 'font-size-small',
      // medium => 16 px
      medium: 'font-size-medium',
      // large => 20 px
      large: 'font-size-large',
      slim: 'font-size-medium'
   );
   $paddingsX: (
      small: (
         ($btn-small-padding / $btn-small-font-size) * 1em,
      ),
      medium: (
         ($btn-medium-padding / $btn-medium-font-size) * 1em,
      ),
      large: (
         ($btn-large-padding / $btn-large-font-size) * 1em,
      ),
      slim: (
         ($btn-small-padding / $btn-medium-font-size) * 1em,
      ),
   );
   // Icon size in em:
   // [icon-size in px] / [relative-button-font-size] / [base-font-size in px] * 1em
   /* prettier-ignore */
   $iconSizes: (
      small: 9 / ($btn-small-font-size / $BROWSER_FONT_SIZE) / $BROWSER_FONT_SIZE * 1em,
      medium: 18 / 1 / $BROWSER_FONT_SIZE * 1em,
      large: 22 / ($btn-large-font-size / $BROWSER_FONT_SIZE) / $BROWSER_FONT_SIZE * 1em,
      slim: 15 / 1 / $BROWSER_FONT_SIZE * 1em,
   );

   /* prettier-ignore */
   $smallIconSizes: (
      small: 6 / ($btn-small-font-size / $BROWSER_FONT_SIZE) / $BROWSER_FONT_SIZE * 1em,
      medium: 12 / 1 / $BROWSER_FONT_SIZE * 1em,
      large: 15 / ($btn-large-font-size / $BROWSER_FONT_SIZE) / $BROWSER_FONT_SIZE * 1em,
      //large-above: 15 / ($btn-small-font-size / $BROWSER_FONT_SIZE) / $BROWSER_FONT_SIZE * 1em,
      slim: 12 / 1 / $BROWSER_FONT_SIZE * 1em,
   );

   $font-size: map-get($fontSizes, $size);
   $padding-x: map-get($paddingsX, $size);
   $icon-size: map-get($iconSizes, $size);
   $small-icon-size: map-get($smallIconSizes, $size);
   $radius-scale: map-get($radiusScales, $size);
   $min-height: map-get($minHeights, $size);

   font-size: css-var($font-size);
   padding: 0 $padding-x;
   border-radius: calc(#{css-var('button-border-radius')} * #{$radius-scale});
   min-height: $min-height;

   @include squareIconButton {
      height: $min-height;
      width: $min-height;
      padding: calc(#{$min-height} - 2px) 0 0; // Compensate for border
   }

   &.env-button--icon .env-icon {
      width: #{$icon-size};
      height: #{$icon-size};
      margin: #{($icon-size / -2)} 0 0 0;
   }

   &.env-button--icon-before {
      padding-left: calc(#{$padding-x} + #{$icon-size} + #{$padding-x / 2});

      .env-icon {
         left: $padding-x;
      }
   }

   &.env-button--icon-after {
      padding-right: calc(#{$padding-x} + #{$icon-size} + #{$padding-x / 2});

      .env-icon {
         right: $padding-x;
      }
   }

   &.env-button--icon-around {
      padding-left: calc(#{$padding-x} + #{$icon-size} + #{$padding-x / 2});
      padding-right: calc(#{$padding-x} + #{$icon-size} + #{$padding-x / 2});

      .env-icon:first-child {
         left: $padding-x;
      }

      .env-icon:last-child {
         right: $padding-x;
      }
   }

   @if ($size == 'medium' or $size == 'large') {
      $fs: ($btn-iconabove-font-size / $BROWSER_FONT_SIZE);
      $mh: $btn-medium-min-height / $btn-iconabove-font-size;
      $pd: 6 / $BROWSER_FONT_SIZE / $fs;
      $icn: 16 /
         ($btn-iconabove-font-size / $BROWSER_FONT_SIZE) /
         $BROWSER_FONT_SIZE;
      $pdt: calc(#{($mh * 1em)} - #{($fs * 1em)} - #{($pd * 2em)} - 2px);
      $brs: (
         (
               $btn-medium-border-radius /
                  $BROWSER_FONT_SIZE /
                  $button-border-radius
            ) /
            ($btn-iconabove-font-size / $BROWSER_FONT_SIZE)
      );

      &.env-button--icon-above {
         font-size: calc(#{css-var('font-size-medium')} * #{$fs});
         line-height: 1;

         .env-icon {
            margin: 0 !important;
            background-color: rgba(255, 0, 255, 0.4);
         }
      }

      @if ($size == 'large') {
         $mh: $btn-large-min-height / $btn-iconabove-font-size;
         $brs: (
            (
                  $btn-large-border-radius /
                     $BROWSER_FONT_SIZE /
                     $button-border-radius
               ) /
               ($btn-iconabove-font-size / $BROWSER_FONT_SIZE)
         );
         $icn: 20 /
            ($btn-iconabove-font-size / $BROWSER_FONT_SIZE) /
            $BROWSER_FONT_SIZE;
         $pd: 10 / $BROWSER_FONT_SIZE / $fs;
         $pdt: calc(#{($mh * 1em)} - #{($fs * 1em)} - #{($pd * 2em)} - 2px);
      }
      &.env-button--icon-above {
         min-height: $mh * 1em;
         min-width: $mh * 1em;
         border-radius: calc(#{css-var('button-border-radius')} * #{$brs});
         padding: 0 $pd * 1em;
         padding-top: $pdt;

         .env-icon {
            width: $icn * 1em !important;
            height: $icn * 1em !important;
            top: $pd * 1em;
         }

         &.env-button--link {
            background-color: #eee;
            $icn: 20 /
               ($btn-iconabove-font-size / $BROWSER_FONT_SIZE) /
               $BROWSER_FONT_SIZE;
            $pd: 3 / $BROWSER_FONT_SIZE / $fs;
            $pdt: calc(#{($mh * 1em)} - #{($fs * 1em)} - #{($pd * 2em)} - 4px);

            @if ($size == 'large') {
               $icn: 24 /
                  ($btn-iconabove-font-size / $BROWSER_FONT_SIZE) /
                  $BROWSER_FONT_SIZE;
               $pd: 6 / $BROWSER_FONT_SIZE / $fs;
               $pdt: calc(
                  #{($mh * 1em)} - #{($fs * 1em)} - #{($pd * 2em)} - 4px
               );
            }
            padding: 0 $pd * 1em;
            padding-top: $pdt;

            .env-icon {
               width: $icn * 1em !important;
               height: $icn * 1em !important;
               top: $pd * 1em;
            }
         }
      }
   }

   @include squareIconButton {
      .env-icon {
         margin: #{($icon-size / -2)} 0 0 #{($icon-size / -2)};
      }
   }

   // Small icons

   &.env-button--icon-small.env-button--icon .env-icon {
      width: #{$small-icon-size};
      height: #{$small-icon-size};
      margin: #{($small-icon-size / -2)} 0 0 0;
   }

   &.env-button--icon-small.env-button--icon-before {
      padding-left: calc(
         #{$padding-x} + #{$small-icon-size} + #{$padding-x / 2}
      );
   }

   &.env-button--icon-small.env-button--icon-after {
      padding-right: calc(
         #{$padding-x} + #{$small-icon-size} + #{$padding-x / 2}
      );
   }

   @include squareIconButton('-small') {
      .env-icon {
         margin: #{($small-icon-size / -2)} 0 0 #{($small-icon-size / -2)};
      }
   }
}
